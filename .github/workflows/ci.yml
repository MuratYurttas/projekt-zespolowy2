name: build_and_test   # ğŸ”¹ Workflow'un ismi (GitHub Actions sekmesinde bu gÃ¶rÃ¼nÃ¼r)

on:                    # ğŸ”¹ Ne zaman Ã§alÄ±ÅŸacaÄŸÄ±nÄ± belirler
  push:                # Her 'push' olayÄ±nda
    branches: [ "main" ]   # Sadece 'main' branch'e push yapÄ±ldÄ±ÄŸÄ±nda

jobs:                  # ğŸ”¹ Ã‡alÄ±ÅŸacak iÅŸler (birden fazla olabilir)
  test:                # Burada bir 'test' iÅŸi tanÄ±mlÄ±yoruz
    runs-on: ubuntu-latest   # GitHub'un Ã§alÄ±ÅŸtÄ±racaÄŸÄ± sanal sistem (Ubuntu)

    steps:             # AdÄ±m adÄ±m yapÄ±lacaklar
      - uses: actions/checkout@v4   # 1ï¸âƒ£ Reponun kodunu indir

      - name: Setup PHP            # 2ï¸âƒ£ PHP kur
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.2'

     - name: Start PHP server
  run: php -S 127.0.0.1:8000 -t public >/dev/null 2>&1 &



      - name: Make tests executable # 4ï¸âƒ£ Test dosyasÄ±nÄ± Ã§alÄ±ÅŸtÄ±rÄ±labilir hale getir
        run: chmod +x tests/integration.sh

      - name: Run integration tests # 5ï¸âƒ£ Testleri Ã§alÄ±ÅŸtÄ±r
        env:
          BASE: http://127.0.0.1:8000
        run: ./tests/integration.sh

  deploy:               # ğŸ”¹ (Opsiyonel) Deploy iÅŸi
    needs: test         # ğŸ”¹ Sadece testler baÅŸarÄ±lÄ± olursa Ã§alÄ±ÅŸÄ±r
    if: success()
    runs-on: ubuntu-latest
    steps:
      - name: Trigger deploy (optional)
        env:
          HOOK: ${{ secrets.DEPLOY_HOOK_URL }}
        run: |
          if [ -n "$HOOK" ]; then
            curl -X POST "$HOOK"
          else
            echo "No deploy hook configured. Skipping deploy."
          fi
